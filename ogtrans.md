# ogtrans - Translate OmniGraffle files

Right now that is relevant for Hebrew, Dutch and Russian translations of the S3 illustrations, however I doubt that I can get the posters translated in time. So focus on the simple use case.

## How to store and retrieve translations

### Open Questions

How can I store Markdown and multiline content in PO files, and how will Crowdin handle that?

### Approach 1: Translation Memory

-   Create a Markdown-based translation memory from the PO file (source --> translation)
-   go through the document and convert each text to Markdown
-   go through that text and translate each sentence/list item through the translation memory
-   convert the resulting Markdown document to RTF and inject back into the document 

**Benefits:**

-   simple to implement
-   I can touch up the English translations and simply re-translate with the existing translation memory as long as I don't change the text

**Challenges:**

-   one string can only have one translation in one file
-   structure of complex texts might be hard to track in Crowdin, as list items and individual sentences might be ripped apart

### Approach 2: IDs

-   on extraction: when extracting text as Markdown, make a copy of the Omnigraffle document and inject autogenerated IDs into each the content part of each text element that a re stored with the extracted content
-   on translation: convert Markdown to rtf, and insert in place of ID in the copy 

**Benefits:**

-   one string can haveseveral in one file
-   structure of complex texts is simpler to track down

**Challenges:**

- every change to the source requires a round trip through the translation platform (but maybe that can be fully automated so that it just takes time, but no interaction)

# Appendix


## Resources

**PO-Files:** http://pology.nedohodnik.net/doc/user/en_US/ch-poformat.html

**Working with RTF:**
		
-     use PyRTF?? (examples: https://github.com/grangier/pyrtf/blob/master/examples/examples.py)
-     convert via textutil? https://ss64.com/osx/textutil.html
-     try textract https://textract.readthedocs.io/en/stable/


## Discussion of architecture

### Strategy 1:

**NOTE: this appears to work good enough for now, ignore the second strategy for now.**
Parse save OmnigraffleDocuments which are XML (plist file) uncompressed, either as flat file or as package,  and then extract rich text to markdown (and back). To allow for a simple parser, the amount of Markup possible needs to be limited!

#### Supported Markup:

1.   one text element contains only one font, and only standard formatting (bold, italics, links)
2.   Support bullet pints (but no nested bullent points)
3.   Extend that to support using light and regular fonts as normal and bold (looks better with Open Sans)

**Benefits:**

-   works with Python, so development is pretty fast 
-   no bugs need to be solved in OmniGraffle

**Challenges:**

-   parsing RTF might turn out to become interesting (seems ok though)
-   how to find out which text goes where? (maybe copy file and replace text with ID??, set those in user data or something)

**Estimate:** After proof of principle, it looks like it might take 2-3 days to get this working.

### Strategy 2: @later

**Looks like strategy 1 is good enough already.**
Write an OmniGraffle Plugin that extracts the text without any formatting. That would work with 90% of the illustrations (but not with posters and primer)

**Benefits**:

- simple

**Challenges:**

-   not all illustrations can be translated that way
-   scripting an omni graffle plugin from outside through script links is not very elegant
-   might require some retouching of the illustrations

**Estimate:** Who knows? Not important right now
	
	
